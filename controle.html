<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle - Space Invaders</title>
    <link rel="stylesheet" href="http://localhost:9091/style.css">
    <style>
        .hide {
            display: none;
        }

    </style>
</head>
<body>
    <div class="bla">
        Vire o smartphone para jogar!
    </div>
    <div class="controls hide">
        <button id="shoot1" class="shoot1">
            <span><ion-icon name="locate-outline"></ion-icon></span>
            <!--<img class="mira" src="http://localhost:9091/mira.png" alt="mira">-->
        </button>
        <!--<img class="cel" src="https://localhost:9091/celular.gif">-->
        <button id="shoot1" class="shoot2">
            <span><ion-icon name="locate-outline"></ion-icon></span>
            <!--<img class="mira" src="http://localhost:9091/mira.png" alt="mira">-->
        </button>
    </div>
    <!--<p id="vire">Vire seu dispositivo!</p>
    <p id="mexa">Mexa seu dispositivo!</p>-->
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        
        var beta = 0;

        // browsers require full screen mode in order to obtain the orientation lock
        var goFullScreen = null;
        var exitFullScreen = null;
        if ('requestFullscreen' in document.documentElement) {
            goFullScreen = 'requestFullscreen';
            exitFullScreen = 'exitFullscreen';
        } else if ('mozRequestFullScreen' in document.documentElement) {
            goFullScreen = 'mozRequestFullScreen';
            exitFullScreen = 'mozCancelFullScreen';
        } else if ('webkitRequestFullscreen' in document.documentElement) {
            goFullScreen = 'webkitRequestFullscreen';
            exitFullScreen = 'webkitExitFullscreen';
        } else if ('msRequestFullscreen') {
            goFullScreen = 'msRequestFullscreen';
            exitFullScreen = 'msExitFullscreen';
        }

        window.alert('Por favor, gire seu dispositivo (celular deitado)');

        window.screen.orientation.addEventListener('change', function(e) {
            const orientation = e.currentTarget.type;
            if(orientation == "landscape-primary" || orientation == "landscape-secondary") {
                document.documentElement[goFullScreen] && document.documentElement[goFullScreen](); 
                window.screen.orientation.lock(orientation);
                document.querySelector(".controls").classList.toggle("hide");
                document.querySelector(".bla").classList.toggle("hide");
            }
        });

        document.addEventListener("fullscreenchange", function(e) {
            if(document.fullscreenElement) {
                console.log("full");
            }else {
                console.log("vire o celular");
                document.querySelector(".controls").classList.toggle("hide");
                document.querySelector(".bla").classList.toggle("hide");
            }
        });

        if (window.screen.orientation.type === "landscape-primary" || window.screen.orientation.type === "landscape-secondary"){
            window.screen.orientation.lock(window.screen.orientation.type);
        }

        window.addEventListener('deviceorientation', (e) => {
            beta = e.beta;
            socket.emit('beta', beta);
        });

        var shoot1 = document.getElementById('shoot1');

        shoot1.addEventListener('touchstart', () => {
            socket.emit('tiro', true);
        });
        shoot1.addEventListener('touchend', () => {
            socket.emit('tiro', false);
        });

        //função para indicar pro usuario virar o celular
        /*window.addEventListener("deviceorientation", function(event) {
            var gamma = event.gamma;
            if (gamma > 20 || gamma < -20) {
                document.getElementById("mexa").style.display = "block";
                document.getElementById("vire").style.display = "none";
            } else {
                document.getElementById("mexa").style.display = "none";
                document.getElementById("vire").style.display = "block";
            }
        }, true);*/
    </script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
</body>
</html>